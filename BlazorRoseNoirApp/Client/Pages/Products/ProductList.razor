@page "/ProductList"
@inject HttpClient http;

@using BlazorRoseNoirApp.Shared;
@using Microsoft.AspNetCore.Authorization;

<h1>La Rose Noir Product List</h1>

<div class="row">

	@foreach(var product in Products)
	{
		<div class="col-lg-4 mb-2"> 

			<ProductCard product="product"></ProductCard>

			<p></p>
			@if(product.Variations != null)
			{
				<div class="text-center">
					@foreach(Variation option in @product.Variations)
					{
						<p class="m-2">@option.Name</p>
					
						<a class="btn-success btn rounded-1 p-2 m-2">Buy</a>
						<NavLink href="@($"product/{product.ProductId}")" class="btn btn-primary p-2 m-2">
							View Details
						</NavLink>
					
						<p class="text-primary">£@option.Price (@option.AvailableStock in stock)</p>
					}
				</div>
			}
		</div>
	}

</div>

@code 
{
	
	private Categories category { get; set; } = Categories.None;

	//Todo: add multiple columns later
	private List<Product> Products = new List<Product>(); //ProductService.GetAllProducts();

	protected override async Task OnInitializedAsync()
	{
		var result = await http.GetFromJsonAsync<List<Product>>("api/Products");
		if (result != null) Products = result;
 	}
}